# 网络
## 宽带
### 主流网络运营商
* 中国电信宽带
* 中国移动铁通宽带
* 中国联通网通宽带
* 长城宽带
### 宽带的性能指标：带宽
* 带宽的实际含义:在给定时间等条件下流过特定区域的最大数据位数
* 带宽的常用单位是Mbps，即兆比每秒
* ADSL宽带速率一般为1Mbps、2Mbps、4Mbps、6Mbps
、8Mbps</br>光纤宽带速率一般为10Mbps、20Mbps、50Mbps、100Mbps、1Gbps
### 不同种类宽带的优缺点
| 宽带种类 | 特点 | 优点 | 缺点 |
| :------: | :------: | :------: | :------: |
| ADSL宽带 | 以电话为信号媒介，下行速度和上行速度不同 | 每个用户独享分配给自己的带宽，比较稳定 | 上网速度受电信部门的总出口带宽的影响，速度一般不高 |
| 社区宽带 | 通信光纤直接铺设到小区的中心机房，小区的各用户组成局域网，最后通过局域网共享主光纤实现上网 | 当整个小区上网的用户比较少，或在线用户比较少时，网速比较高 | 随着上网用户的增多，或上网高峰期，网速下降的同谋十分明显 |
| 光纤宽带 | 光纤网采用光导纤维作传输介质 | 传输距离长，传输率高，可达数千兆bps，抗干扰性强，不会受到电子监听设备的监听 | 价格较高，且需要高水平的安装技术，所以现在尚未普及 |

## 路由器
### 路由器（Router），是连接因特网中各局域网、广域网的设备，它会根据信道的情况自动选择和设定路由，以最佳路径，按前后顺序发送信号。
### 路由器常见性能指标
1. 吞吐量
    * 定义：路由器的包转发能力，一般分为整机和端口吞吐量
    * 单位：Mpps，即每秒可以转发多少百万个数据包
    * 低端的路由器包转发率只有几K到几十Kpps，而高端路由器则能达到几十Mpps（百万包每秒）甚至上百Mpps
2. 路由表能力
    * 定义：路由表内所容纳路由表项数量的极限
    * 单位：条数
    * 高速核心路由器应该能够支持至少25万条路由，平均每个目的地址至少提供2条路径，系统必须支持至少25个BGP对等以及至少50个IGP邻居
3. 背板能力
    * 定义：背板指输入与输出端口间的物理通路
    * 传统的路由器采用的是共享背板的结构，高性能路由器一般采用的是交换式结构。背板能力决定了路由器的吞吐量，背板能力只能在设计中体现，一般无法测试
4. 丢包率
    * 定义：核心路由器在稳定的持续负荷下，由于资源缺少而不能转发的数据包在应该转发的数据包中所占的比例
    * 单位：百分比
    * 计算方法:[(输入报文-输出报文)/输入报文]*100%
    * 丢包率与数据包长度以及包发送频率相关，通常,千兆网卡在流量大于200Mbps时,丢包率小于万分之五;百兆网卡在流量大于60Mbps时,丢包率小于万分之一
5. 时延
    * 定义：数据包第一个比特进入路由器到最后一个比特从核心路由器输出的时间间隔
    * 单位：毫秒，在测试中通常使用测试仪表发出测试包到收到数据包的时间间隔
    * 时延对网络性能影响较大， 作为高速路由器，在最差情况下， 要求对1518字节及以下的IP包时延均都小于1ms
6. 背靠背帧数
    * 定义：以最小帧间隔发送最多数据包不引起丢包时的数据包数量，用于测试核心路由器缓存能力
    * 单位：帧数
    * 测试方法：以最大速率向DUT传送特定数量的测试帧，并统计DUT转发的帧数
    * 指标越大越好，没有上限
### 主流路由器品牌
* 华为
* TP-LINK
* H3C
* 小米
* D-LINK
* Tenda
* 华硕路由器
* NETGEAR
* BUFFALO
* 思科

### 常用路由器分类
| 路由器种类 | 特点 | 优点 | 缺点 |
| :------: | :------: | :------: | :------: |
| 模块化路由器 | 该路由器的接口类型及部分扩展功能是可以根据用户的实际需求来配置的路由器，用户可以根据所要连接的网络类型来选择相应的模块| 当路由器某一部分故障，不影响其他部分正常工作。用户根据实际需求采购模块，节约了成本，因为框架一般很便宜 | 需要自己购买和安装扩展模块，需要一定的动手能力，比较麻烦 |
| 非模块化路由器 | 主要用于连接家庭或ISP内的小型企业客户。它不仅提供SLIP或PPP连接，还支持诸如PPTP和IPSec等虚拟私有网络协议 | 支持许多异构和高速端口，并在各个端口能够运行多种协议 | 一个端口的损坏需将设备上所有业务中断，设备下线更换，不支持功能扩展 |
| 无线路由器 | 带有无线覆盖功能的路由器，支持专线xdsl/ cable，动态xdsl，pptp等接入方式 | 将多种设备合而为一，亦比较适合于初次建网的用户，其集成化的功能可以使用户只用一个设备而满足所有的有线和无线网络需求 | 传输距离较短，一般不超过50米 |
| 无线网络路由器 | 是一种用来连接有线和无线网络的通讯设备，它可以通过Wi-Fi技术收发无线信号来与个人数码助理和笔记本等设备通讯 | 可以在不设电缆的情况下，方便地建立一个电脑网络 | 一般在户外通过无线网络进行数据传输时，它的速度可能会受到天气的影响 |

## 交换机
### 交换机（switch）是一种在通信系统中完成信息交换功能的设备，它应用在数据链路层。交换机有多个端口，每个端口都具有桥接功能，可以连接一个局域网或一台高性能服务器或工作站。实际上，交换机有时被称为多端口网桥。
### 交换机常见性能指标
1. 背板带宽
    * 定义：也叫背板容量，是交换机接口处理器或接口卡和数据总线间所能吞吐的最大数据量
    * 单位：Gbps
    * 计算公式：背板带宽=2 * 端口数 * 相应端口速率
    * 一般的交换机的背板带宽从几Gbps到上百Gbps不等
2. 交换容量
    * 定义：内核CPU与总线的传输容量，一般比背板带宽小
    * 单位：Gbps
    * 计算公式：交换容量=缓存位宽 * 缓存总线频率
3. 包转发率：
    * 定义：衡量网络设备转发数据能力的标准
    * 单位：pps
    * 计算：数据包packet和字节byte对应关系为1packet=64byte，网络中1个数据包最小包含64字节，这64个字节指的是单纯的数据，还要给每个数据包加上8byte的帧头和12byte的帧间隙，因此每传输一个数据包就需要传输64+8+12共84byte。一个1000Mbps的线速端口的最大包转发率为1,000,000,000bps/（84*8bit）≈1,488,095pps=1.488Mpps
    * 万兆线速端口包转发率14.88Mpps</br>千兆线速端口包转发率1.488Mpps</br>百兆线速端口包转发率0.1488Mpps

### 交换机分类
#### 二层交换机
* 二层交换技术的发展比较成熟，二层交换机属数据链路层设备，可以识别数据包中的MAC地址信息，根据MAC地址进行转发，并将这些MAC地址与对应的端口记录在自己内部的一个地址表中
* 二层交换机的特性：
    * 学习端口连接的机器的MAC地址，写入地址表，地址表的大小（一般两种表示方式：一为BEFFER RAM，一为MAC表项数值），地址表大小影响交换机的接入容量
    * 一般都含有专门用于处理数据包转发的ASIC（Application specific Integrated Circuit，专用集成电路）芯片，因此转发速度可以做到非常快
#### 三层交换机
* 三层交换机就是具有部分路由器功能的交换机，三层交换机的最重要目的是加快大型局域网内部的数据交换，所具有的路由功能也是为这目的服务的，能够做到一次路由，多次转发。三层交换技术是在网络模型中的第三层实现了数据包的高速转发，既可实现网络路由功能，又可根据不同网络状况做到最优网络性能
* 三层交换机的特性：
    * 高可扩充性：三层交换机在连接多个子网时，子网只是与第三层交换模块建立逻辑连接，不像传统外接路由器那样需要增加端口，从而保护了用户对校园网、城域教育网的投资。并满足学校3~5年网络应用快速增长的需要。
    * 高性价比：三层交换机具有连接大型网络的能力，功能基本上可以取代某些传统路由器，但是价格却接近二层交换机。一台百兆三层交换机的价格只有几万元，与高端的二层交换机的价格差不多。
    * 内置安全机制：三层交换机可以与普通路由器一样，具有访问列表的功能，可以实现不同VLAN间的单向或双向通讯。如果在访问列表中进行设置，可以限制用户访问特定的IP地址，这样学校就可以禁止学生访问不健康的站点，也可防止非法外部用户访问内部网络资源
    * 多媒体传输：教育网经常需要传输多媒体信息，这是教育网的一个特色。三层交换机具有QoS（服务质量）的控制功能，可以给不同的应用程序分配不同的带宽。例如，在校园网、城域教育网中传输视频流时，就可以专门为视频传输预留一定量的专用带宽，相当于在网络中开辟了专用通道，其他的应用程序不能占用这些预留的带宽，因此能够保证视频流传输的稳定性。
    * 计费功能：在高校校园网及有些地区的城域教育网中，很可能有计费的需求，因为三层交换机可以识别数据包中的IP地址信息，因此可以统计网络中计算机的数据流量，可以按流量计费，也可以统计计算机连接在网络上的时间，按时间进行计费。而普通的二层交换机就难以同时做到这两点。
#### 四层交换机
* 第四层交换机是基于传输层数据包的交换过程的，是一类基于TCP/IP协议应用层的用户应用交换需求的新型局域网交换机，支持TCP/UDP第四层以下的所有协议
* 四层交换机特性
    * 包过滤/安全控制：第四层交换区别于第三层交换的主要不同之处，就是在于这种过滤能力是在ASIC专用高速芯片中实现的，从而使这种安全过滤控制机制可以全线速地进行，极大地提高了包过滤速率。
    * 服务质量：在网络系统的层次结构中，TCP/UDP第四层信息，往往用于建立应用级通信优先权限。第四层交换机允许用基于目的地址、目的端口号（应用服务）的组合来区分优先级，于是紧急应用就可以获得网络的高级别服务。
    * 服务器负载均衡：在相似服务内容的多台服务器间提供平衡流量负载支持时，第四层信息是至关重要的。第四层交换机所支持的服务器负载均衡方式，是将附加有负载均衡服务的IP地址，通过不同的物理服务器组成一个集，共同提供相同的服务，并将其定义为一个单独的虚拟服务器。这个虚拟服务器是一个有单独IP地址的逻辑服务器，用户数据流只需指向虚拟服务器的IP地址，而不直接和物理服务器的真实IP地址进行通信。只有通过交换机执行的网络地址转换（NAT）后，未被注册IP地址的服务器才能获得被访问的能力。这种定义虚拟服务器的另一好处是，在隐藏服务器的实际IP地址后，可以有效地防止非授权访问。
    * 主机备用连接：主机备用连接为端口设备提供了冗余连接，从而在交换机发生故障时有效保护系统，这种服务允许定义主备交换机，同虚拟服务器定义一样，它们有相同的配置参数。由于第四层交换机共享相同的MAC地址，备份交换机接收和主单元全部一样的数据。这使得备份交换机能够监视主交换机服务的通信内容。主交换机持续地通知备份交换机第四层的有关数据、MAC数据以及它的电源状况。主交换机失败时，备份交换机就会自动接管，不会中断对话或连接。

## 评价
对于各种网络设备（包括宽带、路由器、交换机）的选择，需要根据实际的应用场景来决定适合的组合。就宽带而言，光纤以其高速率、稳定性、安全性无疑是最优的选择，而近年来上海一直在推进光纤入户，所以以前光纤一直存在的价格昂贵的缺点现在也可以克服，光纤几乎可以说是当下宽带的首选。交换机的作用主要是实现大家通过一根网线上网，一般情况下大家上网都是分别拨号的，都在使用自己的宽带，所以哪怕有人在下载其他东西，也自己上网也没有任何影响的，而且所有使用同一条交换机的电脑都在同一局域网内的。路由器比交换机多了虚拟拨号的功能，可以共用一个宽带账号，所以对于大家上网是会相互影响的，也就是说一台电脑在下载资料，其他电脑就会变得更卡的，网速会慢很多。对于家用而言，共享同一个宽带账号是比较普遍的选择，所以大多数人会选择使用路由器，而在大学寝室这个场景下，大家每个人都有属于自己的宽带账号，这时使用交换机上网可以保证上网不互相影响，也是不错的选择，当然交换机和路由器也可以搭配使用，对于企业而言可以将宽带线连接至路由器，再把路由器的输出宽带线连到交换机，通过交换机分开让数十台电脑使用。对于路由器和交换机各自不同的种类也需要根据使用场景需求的不同选购不同的种类。

# Storage(Ceph)
## Ceph简介
Ceph FS是一个维持POSIX兼容的同时还集成了复制、容错的文件系统,它使用Ceph存储集群来存储数据。Ceph始于加州大学圣克鲁兹分校的Sage Weil的博士学位课题，并于2010年3月起，成为了Linux系统进军可扩展存储领域不可或缺的核心系统。目前，Ceph在红帽推动下已扩展到支持容器和文件存储，对对象、块和文件存储同时具备很好的系统支持能力，是可处理PB级数据的统一存储系统  
Ceph的生态系统主要划分为四部分：客户端（使用者）、元数据服务器（管理文件系统的命名空间）、对象存储集群（以对象方式存储数据和元数据）以及集群监控（实现监控）。
## Ceph的主要技术特性
* CRUSH算法  
Ceph采用一种名为可扩展哈希受控复制（CRUSH）算法的伪随机映射，使得数据映射到存储设备不依赖于任何元数据，而是依赖于伪随机映射函数。它最小化了存储的负荷，以及简化了数据的分布和查询。  
* 容错特性及错误恢复
Ceph集成了容错特性来防止单点故障，并假定大规模（PB级）的存储故障是一种常态，而非异常。Ceph的设计没有假定特定的工作负荷，而是包含了可变的分布式工作负荷的适应能力，从而保证了在不同负荷下都能发挥出高性能。Ceph的元数据服务器采用将元数据缓存在短期的日志中的方式，保证可以立即对客户端提供最新的元数据服务，同时日志也能确保元数据的安全性，在发生故障时即使恢复。  
* RADOS  
Ceph采用了RADOS的方式，由Ceph对象存储来提供从“对象”到“块”的映射，而不是由客户端的文件系统层来提供。并且因为Ceph客户端使用CRUSH，不知道磁盘上文件的块映射信息，所以底层的存储设备可以安全的管理从对象到块的映射。这使得即使设备被发现失效，也能依靠节点复制数据。这种失效恢复的分布式机制大幅提高了存储系统的可扩展性。
* 动态增加节点  
Ceph采用了元数据动态子树分区，可以增加元数据服务器和存储节点，增强了容量和性能的可扩展性
## Ceph支持的存储类型
### 块存储：可以直接以逻辑卷的方式对外提供块设备服务
* 典型设备：磁盘阵列，硬盘
* 优点：
    - 通过Raid与LVM等手段，对数据提供了保护
    - 多块廉价的硬盘组合起来，提高容量
    - 多块磁盘组合出来的逻辑盘，提升读写效率
* 缺点：
    - 造价成本高
    - 主机之间无法共享数据
### 文件存储：通过集群的对象存储网关，对外同时提供swift和S3风格的对象存储服务
* 典型设备：FTP、NFS服务器
* 优点：
    - 造价成本低
    - 支持共享数据
* 缺点：
    - 读写、传输速率慢
### 对象存储：提供可供挂载的类POSIX文件存储服务
* 典型设备：内置大容量硬盘的分布式服务器如swift、S3
* 优点：
    - 读写速率快
    - 支持共享数据
## Ceph的优势  
* 采用CRUSH算法，减小了存储符合，提高了整体性能
* 支持数千节点，且元数据服务器支持动态增加节点，可扩展性强
* 容错性强，可预防单点故障
* 可处理PB级数据
## Ceph的缺陷
* Ceph是开源社区，而不是成熟的产品
* Ceph在国内大量部署还只是针对传统软件堆栈,而不是云计算
## 我的评论  
Ceph从2004在一个社区里出现原型，到现在已经发展成可运行大量工作负载的真实系统，我觉得一方面是因为Ceph运用了许多先进的设计理念，如CRUSH算法、元数据动态子树分区等，这些设计理念是Ceph得以成功的基础。另一方面，Ceph的与时俱进也是它能够发展得越来越好必不可少的一个因素。目前，Ceph在国内与国外最大区别是，在国外既能适应新型的云计算的软件堆栈，也能适应传统的应用软件堆栈，而在国内大部分的部署还是针对传统的软件堆栈。Ceph作为一个统一的存储平台，不仅要统一存储类型（块、文件、对象存储），也应给统一起传统模式稳态的应用和新型模式敏态的应用。